#cloud-config

growpart:
  mode: auto
  devices: ['/']

chpasswd:
  list: |
    root:root
    ubuntu:password
  expire: false

ssh_pwauth: True
disable_root: false

# upgrade packages on startup
package_upgrade: false

packages:
  - eatmydata
  - openssh-server
  - silversearcher-ag

write_files:
  - path: /var/tmp/fan-250-user.user-data
    content: |
      #cloud-config
      package_upgrade: false
  - path: /etc/cloud/cloud.cfg.d/99-cloud-init-no-netconfig.cfg
    content: |
      network: {config: disabled}
  - path: /etc/apt/apt.conf.d/02apt-cacher
    content: |
      Acquire::http { Proxy "http://192.168.100.1:3142"; };
  - path: /etc/resolvconf/resolv.conf.d/head
    content: |
      nameserver 192.168.100.1

package_reboot_if_required: true

runcmd:
  - for i in /usr/bin/apt*; do ln -s /usr/bin/eatmydata /usr/local/bin/$(basename $i); done
  - update-alternatives --set editor /usr/bin/vim.basic

power_state:
  mode: reboot
  condition: True
